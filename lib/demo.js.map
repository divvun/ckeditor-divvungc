{"version":3,"sources":["../src/demo.js"],"names":["debug","location","protocol","log","console","bind","window","Inline","Quill","import","ErrorBlot","beg","len","spanoff","$","domNode","offset","newoff","top","left","repmenu","at_same_err","is","hiderep","show","makerepmenu","span","err","data","empty","tbody","document","createElement","attr","tr_typ","td_typ","a_typ","typ","length","text","errtypes","append","addClass","exp","tr_exp","td_exp","a_exp","rep","map","r","tr_rep","td_rep","a_rep","replace","lastIndexOf","indexOf","click","replaceErr","tr_ign","td_ign","a_ign","node","colour","setAttribute","blotName","tagName","register","e","delta","ops","retain","delete","insert","quill","updateContents","atMostOneSpace","checkOnIdle","focus","hide","onSelectionChange","range","_oldRange","source","erroroffset","scroll","descendant","index","error","showrep","i","t","getFText","deleteText","clearErrs","formatText","getLength","applyErrs","res","tokErrs","forEach","x","str","end","toolbarOptions","header","list","modules","toolbar","container","handlers","check","_val","theme","placeholder","getContents","op","join","examples","title","searchToObject","pairs","search","substring","split","obj","pair","key","val","decodeURIComponent","port","hostname","apiversion","checkUrl","toString","authUrl","errtypesUrl","userLang","JSON","parse","localStorage","getItem","getErrtypes","cb","ajax","type","url","lang","success","setItem","stringify","jqXHR","textStatus","status","html","showLogin","removeItem","dataType","hideLogin","removeClass","getAuthToken","userpass","authToken","errXHR","u","p","servercheck","a","q","readLoginFormStoring","loginFromForm","_authToken","loginOnEnter","which","loginOnClick","idleTimer","delay","clearTimeout","setTimeout","onTextChange","oldDelta","logout","init","keypress","ex","setContents","ajaxSetup","statusCode","on","initText","ready"],"mappings":"AAGA,a,o1DAYA,GAAIA,OAAqC,OAA7B,UAAOC,QAAP,CAAgBC,QAA5B,CACIC,IAAMH,MAAQI,QAAQD,GAAR,CAAYE,IAAZ,CAAiBC,OAAOF,OAAxB,CAAR,CAA2C,UAAW,CAAE,CADlE,CAIIG,OAASC,MAAMC,MAAN,CAAa,cAAb,CAJb,C,GAKMC,U,gSA0BIC,C,CACAC,C,CAER,CACE,GAAIC,GAAUC,EAAE,KAAKC,OAAP,EAAgBC,MAAhB,EAAd,CACIC,EAAS,CAAEC,IAAML,EAAQK,GAAR,CAAY,EAApB,CACEC,KAAMN,EAAQM,IADhB,CADb,CAGIC,EAAUN,EAAE,UAAF,CAHd,CAIIO,EAAcD,EAAQJ,MAAR,GAAiBE,GAAjB,EAAwBD,EAAOC,GAA/B,EAAsCE,EAAQJ,MAAR,GAAiBG,IAAjB,EAAyBF,EAAOE,IAJxF,CAKGC,EAAQE,EAAR,CAAW,UAAX,GAA0BD,CAN/B,CAOIE,SAPJ,EAUIH,EAAQI,IAAR,EAVJ,CAWIJ,EAAQJ,MAAR,CAAeC,CAAf,CAXJ,CAYO,CAACI,CAZR,EAaM,KAAKI,WAAL,CAAiBd,CAAjB,CAAsBC,CAAtB,CAbN,CAgBC,C,gDAOWD,C,CACAC,C,CACC,CACX,GAAIc,GAAO,KAAKX,OAAhB,CACIY,EAAMb,EAAEY,CAAF,EAAQE,IAAR,CAAa,OAAb,CADV,CAGAd,EAAE,cAAF,EAAkBe,KAAlB,EAJW,CAKX,GAAIC,GAAQhB,EAAEiB,SAASC,aAAT,CAAuB,OAAvB,CAAF,CAAZ,CACAF,EAAMG,IAAN,CAAW,MAAX,CAAmB,SAAnB,CANW,CAQX,GAAIC,GAAUpB,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CAAd,CACAG,EAAUrB,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CADV,CAEAI,EAAStB,EAAEiB,SAASC,aAAT,CAAuB,MAAvB,CAAF,CAFT,CAeA,GAZgC,CAA7B,YAAWL,EAAIU,GAAf,EAAoBC,MAYvB,CAXEF,EAAMG,IAAN,CAAW,iBAAX,CAWF,CAREH,EAAMG,IAAN,CAAWC,WAAWb,EAAIU,GAAf,EAAoB,CAApB,CAAX,CAQF,CANAD,EAAMH,IAAN,CAAW,eAAX,CAA4B,MAA5B,CAMA,CALAE,EAAOM,MAAP,CAAcL,CAAd,CAKA,CAJAD,EAAOO,QAAP,CAAgB,aAAhB,CAIA,CAHAR,EAAOO,MAAP,CAAcN,CAAd,CAGA,CAFAL,EAAMW,MAAN,CAAaP,CAAb,CAEA,CAAc,EAAX,IAAIS,GAAP,CAAkB,CAChB,GAAIC,GAAU9B,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CAAd,CACAa,EAAU/B,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CADV,CAEAc,EAAShC,EAAEiB,SAASC,aAAT,CAAuB,MAAvB,CAAF,CAFT,CAGAc,EAAMP,IAAN,CAAWZ,EAAIgB,GAAf,CAJgB,CAKhBG,EAAMb,IAAN,CAAW,eAAX,CAA4B,MAA5B,CALgB,CAMhBY,EAAOJ,MAAP,CAAcK,CAAd,CANgB,CAOhBD,EAAOH,QAAP,CAAgB,aAAhB,CAPgB,CAQhBE,EAAOH,MAAP,CAAcI,CAAd,CARgB,CAShBf,EAAMW,MAAN,CAAaG,CAAb,CACD,CAEDjB,EAAIoB,GAAJ,CAAQC,GAAR,CAAY,SAASC,CAAT,CAAW,CACrB,GAAIC,GAAUpC,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CAAd,CACImB,EAAUrC,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CADd,CAEIoB,EAAStC,EAAEiB,SAASC,aAAT,CAAuB,GAAvB,CAAF,CAFb,CAGQ,EAAL,GAJkB,CAKnBoB,EAAMb,IAAN,CAAW,SAAX,CALmB,CAQnBa,EAAMb,IAAN,CAAWU,EAAEI,OAAF,CAAU,IAAV,CAAgB,GAAhB,CAAX,CARmB,EAUK,CAAvB,IAAEC,WAAF,CAAc,GAAd,CAAmB,CAAnB,GAA4BL,EAAEM,OAAF,CAAU,GAAV,CAAcN,EAAEX,MAAF,CAAS,CAAvB,GAA2BW,EAAEX,MAAF,CAAS,CAV9C,GAYnBc,EAAMV,QAAN,CAAe,UAAf,CAZmB,CAcrBU,EAAMnB,IAAN,CAAW,MAAX,CAAmB,QAAnB,CAdqB,CAerBkB,EAAOV,MAAP,CAAcW,CAAd,CAfqB,CAgBrBD,EAAOT,QAAP,CAAgB,aAAhB,CAhBqB,CAiBrBS,EAAOT,QAAP,CAAgB,kBAAhB,CAjBqB,CAmBrBS,EAAOK,KAAP,CAAa,CAAE7C,IAAKA,CAAP,CACEC,IAAKA,CADP,CAEEqC,EAAGA,CAFL,CAAb,CAIaQ,UAJb,CAnBqB,CAwBrBP,EAAOT,MAAP,CAAcU,CAAd,CAxBqB,CAyBrBrB,EAAMW,MAAN,CAAaS,CAAb,CACD,CA1BD,CAnCW,CA+DX,GAAIQ,GAAU5C,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CAAd,CACA2B,EAAU7C,EAAEiB,SAASC,aAAT,CAAuB,IAAvB,CAAF,CADV,CAEA4B,EAAS9C,EAAEiB,SAASC,aAAT,CAAuB,GAAvB,CAAF,CAFT,CAGA4B,EAAMrB,IAAN,CAAW,mBAAX,CAlEW,CAmEXqB,EAAM3B,IAAN,CAAW,MAAX,CAAmB,QAAnB,CAnEW,CAoEX0B,EAAOlB,MAAP,CAAcmB,CAAd,CApEW,CAqEXD,EAAOjB,QAAP,CAAgB,aAAhB,CArEW,CAsEXiB,EAAOjB,QAAP,CAAgB,kBAAhB,CAtEW,CAuEXgB,EAAOjB,MAAP,CAAckB,CAAd,CAvEW,CAwEX7B,EAAMW,MAAN,CAAaiB,CAAb,CAxEW,CA0EX5C,EAAE,cAAF,EAAkB2B,MAAlB,CAAyBX,CAAzB,CACD,C,wCAhIaH,C,CAAK,CACjB,GAAIkC,uFAAJ,CACA,GAAkB,QAAf,sBAAOlC,EAAP,qBAAOA,CAAP,EAAH,CAEE,MADAvB,SAAQD,GAAR,CAAY,sEAAyDwB,EAAzD,qBAAyDA,CAAzD,EAAZ,CACA,sFAEFb,EAAE+C,CAAF,EAAQjC,IAAR,CAAa,OAAb,CAAsBD,CAAtB,CANiB,CAQjB,GAAImC,GAAS,MAAb,CACG,oBAA2BtB,WAAWF,MAAX,CAAoBX,EAAIU,GAAJ,CAAQ,CAAvD,EAA4D,UAAIA,GATlD,CAUfjC,QAAQD,GAAR,CAAY,yBAAyBwB,EAAIU,GAA7B,CAAiC,iBAA7C,CAVe,CAYqB,CAA9B,aAAWV,EAAIU,GAAf,EAAoBC,MAZX,GAafwB,EAAStB,WAAWb,EAAIU,GAAf,EAAoB,CAApB,CAbM,EAchB,CAED,MADAwB,GAAKE,YAAL,CAAkB,OAAlB,CAA2B,eAAeD,CAA1C,CACA,CAAOD,CACR,C,wCACcA,C,CAAM,CACnB,MAAO/C,GAAE+C,CAAF,EAAQjC,IAAR,CAAa,OAAb,CACR,C,eArBqBrB,M,EAoIxBG,UAAUsD,QAAV,CAAqB,O,CACrBtD,UAAUuD,OAAV,CAAoB,M,CACpBzD,MAAM0D,QAAN,CAAexD,SAAf,C,CAEA,GAAI+C,YAAa,QAAbA,WAAa,CAASU,CAAT,CAAY,CAC3B5C,SAD2B,CAE3B,GAAI6C,GAAQ,CAAEC,IAAI,CAChB,CAAEC,OAAQH,EAAEvC,IAAF,CAAOjB,GAAjB,CADgB,CAEhB,CAAE4D,OAAQJ,EAAEvC,IAAF,CAAOhB,GAAjB,CAFgB,CAGhB,CAAE4D,OAAQL,EAAEvC,IAAF,CAAOqB,CAAjB,CAHgB,CAAN,CAAZ,CAMAwB,MAAMC,cAAN,CAAqBN,CAArB,CAA4B,MAA5B,CAR2B,CAS3BO,eAAeR,EAAEvC,IAAF,CAAOjB,GAAtB,CAT2B,CAU3BiE,YAAY,IAAZ,CAV2B,CAW3BH,MAAMI,KAAN,EACD,CAZD,CAiBItD,QAAU,QAAVA,QAAU,EACd,CAEE,GAAIH,GAAUN,EAAE,UAAF,CAAd,CACAM,EAAQJ,MAAR,CAAe,CAACE,IAAI,CAAL,CAAQC,KAAK,CAAb,CAAf,CAHF,CAIEC,EAAQ0D,IAAR,EACD,CAvBD,CA0BIC,kBAAoB,QAApBA,kBAAoB,CAASC,CAAT,CAAgBC,CAAhB,CAA2BC,CAA3B,CAAmC,CACzD,GAAY,IAAT,KAAkC,CAAjB,KAAM5C,MAAvB,EAAiD,MAAV,GAA1C,CAA4D,CAC1D,GAAI6C,GAAcV,MAAMW,MAAN,CAAaC,UAAb,CAAwB3E,SAAxB,CAAmCsE,EAAMM,KAAzC,CAAlB,CACIC,EAAQJ,EAAY,CAAZ,CADZ,CAEInE,EAASmE,EAAY,CAAZ,CAFb,CAGA,GAAY,IAAT,GAAH,CAAkB,CAChB,GAAIxE,GAAMqE,EAAMM,KAAN,CAActE,CAAxB,CACIJ,EAAM2E,EAAMjD,MAAN,EADV,CAEAiD,EAAMC,OAAN,CAAc7E,CAAd,CAAmBC,CAAnB,CACD,CACF,CACF,CArCD,CAuCI+D,eAAiB,QAAjBA,eAAiB,CAASc,CAAT,CAAY,KAC/B,GAAIC,GAAIC,UADuB,CAEf,GAAV,IAAEF,EAAE,CAAJ,CAFyB,EAG7BA,GAH6B,KAK/B,GAAI7E,GAAM,CALqB,CAMb,GAAZ,IAAE6E,EAAE7E,CAAJ,CANyB,EAO7BA,GAP6B,CAUtB,CAAN,EAV4B,EAW7B6D,MAAMmB,UAAN,CAAiBH,CAAjB,CAAoB7E,EAAI,CAAxB,CAA2B,MAA3B,CAEH,CApDD,CAuDIiF,UAAY,QAAZA,UAAY,EAAY,CAC1BpB,MAAMqB,UAAN,CAAiB,CAAjB,CAAoBrB,MAAMsB,SAAN,EAApB,CAAuC,OAAvC,IACD,CAzDD,CA2DIC,UAAY,QAAZA,UAAY,CAASzD,CAAT,CAAe0D,CAAf,CAAoB,CAClCA,EAAIC,OAAJ,CAAYC,OAAZ,CAAoB,SAASC,CAAT,CAAY,CAC9B,GAAI9D,GAAS8D,EAAE,CAAF,EAAOA,EAAE,CAAF,CAApB,CACAjG,IAAIiG,CAAJ,CAF8B,CAG9B3B,MAAMqB,UAAN,CAAiBM,EAAE,CAAF,CAAjB,CAAuB9D,CAAvB,CACiB,OADjB,CACyB,CACN+D,IAAKD,EAAE,CAAF,CADC,CAENzF,IAAKyF,EAAE,CAAF,CAFC,CAGNE,IAAKF,EAAE,CAAF,CAHC,CAINxF,IAAK0B,CAJC,CAKND,IAAK+D,EAAE,CAAF,CALC,CAMNrD,IAAKqD,EAAE,CAAF,CANC,CAONzD,IAAKyD,EAAE,CAAF,CAPC,CADzB,CAUD,CAbD,CADkC,CAelCjG,IAAI8F,CAAJ,CACD,CA3ED,CA8EIM,eAAiB,CACnB,CAAC,CAAEC,iBAAF,CAAD,CADmB,wCAInB,CAAC,CAAEC,KAAM,SAAR,CAAD,CAAsB,CAAEA,KAAM,QAAR,CAAtB,CAJmB,qBA9ErB,CAuFIhC,MAAQ,GAAIjE,MAAJ,CAAU,SAAV,CAAqB,CAC/BkG,QAAS,CACPC,QAAS,CACPC,UAAWL,cADJ,CAEPM,SAAU,CACRC,MAAO,eAASC,CAAT,CAAe,CAAED,QAAU,CAD1B,CAFH,CADF,CADsB,CAS/BE,MAAO,MATwB,CAU/BC,YAAa,+CAVkB,CAArB,CAvFZ,CAuGItB,SAAW,QAAXA,SAAW,EAAW,CACxB,MAAOlB,OACJyC,WADI,GAEJ7C,GAFI,CAGJrB,GAHI,CAGA,SAASmE,CAAT,CAAa,CAChB,MAA4B,QAArB,QAAOA,GAAG3C,MAAV,CAAgC2C,EAAG3C,MAAnC,CAA4C,GACpD,CALI,EAMJ4C,IANI,CAMC,EAND,CAOR,CA/GD,CAiHIC,SAAW,CACb,CAAEC,MAAO,YAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAO,gNAAT,CAAD,CAAP,CADT,CADa,CAGb,CAAE8C,MAAO,eAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,gTAAV,CAAD,CAAP,CADT,CAHa,CAKb,CAAE8C,MAAO,iBAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,4NAAV,CAAD,CAAP,CADT,CALa,CAOb,CAAE8C,MAAO,wBAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,yQAAV,CAAD,CAAP,CADT,CAPa,CASb,CAAE8C,MAAO,aAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,wIAAV,CAAD,CAAP,CADT,CATa,CAWb,CAAE8C,MAAO,eAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,gHAAV,CAAD,CAAP,CADT,CAXa,CAab,CAAE8C,MAAO,aAAT,CACElD,MAAO,CAAEC,IAAK,CAAC,CAAEG,OAAQ,6EAAV,CAAD,CAAP,CADT,CAba,CAjHf,CAkII+C,eAAiB,QAAjBA,eAAiB,EACrB,CAEE,GAAIC,GAAQlH,OAAOL,QAAP,CAAgBwH,MAAhB,CAAuBC,SAAvB,CAAiC,CAAjC,EAAoCC,KAApC,CAA0C,GAA1C,CAAZ,CACIC,EAAM,EADV,CAEA,IAAK,GAAInC,EAAT,GAAc+B,EAAd,CACE,GAA4B,CAAC,CAAzB,GAAM/B,CAAN,EAASlC,OAAT,CAAiB,GAAjB,CAAJ,CAAgC,CAC9B,GAAIsE,GAAOL,EAAM/B,CAAN,EAASkC,KAAT,CAAe,GAAf,CAAX,CACIG,EAAMD,EAAK,CAAL,CADV,CAEIE,EAAMF,EAAK,CAAL,EAAQxE,OAAR,CAAgB,KAAhB,CAAuB,KAAvB,CAFV,CAGAuE,EAAII,mBAAmBF,CAAnB,CAAJ,EAA+BE,mBAAmBD,CAAnB,CAChC,CAEH,MAAOH,EACR,CAhJD,CAkJIK,KAA+C,OAA7B,UAAOhI,QAAP,CAAgBC,QAAhB,CAAuC,MAAvC,CAAgDI,OAAOL,QAAP,CAAgBgI,IAlJtF,CAmJIC,SAAmD,EAA7B,UAAOjI,QAAP,CAAgBiI,QAAhB,CAAkC,WAAlC,CAAgD5H,OAAOL,QAAP,CAAgBiI,QAnJ1F,CAoJIhI,SAAmD,OAA7B,UAAOD,QAAP,CAAgBC,QAAhB,CAAuC,OAAvC,CAAiDI,OAAOL,QAAP,CAAgBC,QApJ3F,CAqJIiI,WAAsB,KArJ1B,CAuJIC,SAAsBlI,SAAS,IAAT,CAAcgI,QAAd,CAAuB,GAAvB,CAA4BD,KAAKI,QAAL,EAA5B,CAA6CF,UAA7C,CAAwD,QAvJlF,CAwJIG,QAAqBpI,SAAS,IAAT,CAAcgI,QAAd,CAAuB,GAAvB,CAA4BD,KAAKI,QAAL,EAA5B,CAA6CF,UAA7C,CAAwD,eAxJjF,CAyJII,YAAyBrI,SAAS,IAAT,CAAcgI,QAAd,CAAuB,GAAvB,CAA4BD,KAAKI,QAAL,EAA5B,CAA6CF,UAA7C,CAAwD,cAzJrF,CA0JAhI,IAAIiI,QAAJ,C,CACAjI,IAAImI,OAAJ,C,CACAnI,IAAIoI,WAAJ,C,CAEA,GAAIC,UAAW,QAAXA,SAAW,EAAW,CAExB,MAAO,KACR,CAHD,CAKIhG,SAAW,QAAXA,SAAW,EAAW,CACxB,MAAOiG,MAAKC,KAAL,CAAWpI,OAAOqI,YAAP,CAAoBC,OAApB,CAA4B,UAA5B,CAAX,CACR,CAPD,CASIC,YAAc,QAAdA,YAAc,CAASC,CAAT,CAAa,CAC7B,GAAI7C,GAAMnF,EAAEiI,IAAF,CAAO,CACfC,KAAM,KADS,CAEfC,IAAKV,WAFU,CAGf3G,KAAM,CACJsH,KAAMV,UADF,CAHS,CAMfW,QAAS,iBAAS3G,CAAT,CAAkB,CACzBrC,IAAI,iBAAJ,CADyB,CAEzBA,IAAIqC,CAAJ,CAFyB,CAGzBlC,OAAOqI,YAAP,CAAoBS,OAApB,CAA4B,UAA5B,CAAwCX,KAAKY,SAAL,CAAe7G,CAAf,CAAxC,CAHyB,CAIzBsG,GACD,CAXc,CAYfvD,MAAO,eAAS+D,CAAT,CAAgBC,CAAhB,CAAuC5H,CAAvC,CAAuD,CAC1C,OAAf,MAA2C,CAAjB,KAAM6H,MADyB,CAE1D1I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,qGAAvB,CAF0D,CAIrC,OAAf,GAJoD,EAK1D3I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,kBAAkBF,CAAlB,CAA6B,IAA7B,CAAkC5H,CAAlC,CAAsC,GAAtC,CAA0C2H,EAAME,MAAhD,4EAAvB,CAL0D,CAO5D1I,EAAE,cAAF,EAAkBU,IAAlB,EAP4D,CAS5DkI,WAT4D,CAU5DpJ,OAAOqI,YAAP,CAAoBgB,UAApB,CAA+B,UAA/B,CACD,CAvBc,CAwBfC,SAAU,MAxBK,CAAP,CAAV,CA0BAzJ,IAAI8F,CAAJ,CACD,CArCD,CAuCI4D,UAAY,QAAZA,UAAY,EAAY,CAC1B/I,EAAE,cAAF,EAAkBgE,IAAlB,EAD0B,CAE1BhE,EAAE,YAAF,EAAgBgE,IAAhB,EAF0B,CAG1BhE,EAAE,UAAF,EAAcgJ,WAAd,CAA0B,MAA1B,CAH0B,CAI1BhJ,EAAE,gBAAF,EAAoBgJ,WAApB,CAAgC,YAAhC,CAJ0B,CAK1BhJ,EAAE,SAAF,EAAaU,IAAb,EACD,CA7CD,CA+CIkI,UAAY,QAAZA,UAAY,EAAY,CAE1B5I,EAAE,YAAF,EAAgBU,IAAhB,EAF0B,CAG1BV,EAAE,UAAF,EAAc4B,QAAd,CAAuB,MAAvB,CAH0B,CAI1B5B,EAAE,gBAAF,EAAoB4B,QAApB,CAA6B,YAA7B,CAJ0B,CAK1B5B,EAAE,SAAF,EAAagE,IAAb,EACD,CArDD,CAuDIiF,aAAe,QAAfA,aAAe,CAASC,CAAT,CACSlB,CADT,CAEnB,CACE3I,IAAI,cAAJ,CADF,CAEE,GAAI8F,GAAMnF,EAAEiI,IAAF,CAAO,CACfC,KAAM,MADS,CAEfC,IAAKX,OAFU,CAGf1G,KAAMoI,CAHS,CAIfb,QAAS,iBAASc,CAAT,CAAmB,CAC1B9J,IAAI,uBAAJ,CAD0B,CAE1BG,OAAOqI,YAAP,CAAoBS,OAApB,CAA4B,WAA5B,CAAyCa,CAAzC,CAF0B,CAG1BJ,WAH0B,CAI1BhB,YAAY,UAAW,CACrBC,EAAGmB,CAAH,CACD,CAFD,CAGD,CAXc,CAYf1E,MAAO,eAAS+D,CAAT,CAAgBC,CAAhB,CAAuCW,CAAvC,CAA0D,CAC/C,IAAZ,KAAkC,EAAd,IAASC,CAA7B,EAAsD,EAAd,IAASC,CADU,CAE7DtJ,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,+BAAvB,CAF6D,CAIxC,OAAf,MAAqC,cAAX,IAJ6B,CAK7D3I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,+CAAvB,CAL6D,CAOxC,OAAf,MAA2C,CAAjB,KAAMD,MAPuB,CAQ7D1I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,qGAAvB,CAR6D,CAW7D3I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,kBAAkBF,CAAlB,CAA6B,IAA7B,CAAkCW,CAAlC,CAAyC,GAAzC,CAA6CZ,EAAME,MAAnD,mDAAvB,CAX6D,CAa/D1I,EAAE,cAAF,EAAkBU,IAAlB,EAb+D,CAc/DkI,WAd+D,CAe/DpJ,OAAOqI,YAAP,CAAoBgB,UAApB,CAA+B,WAA/B,CACD,CA5Bc,CA6BfC,SAAU,MA7BK,CAAP,CAAV,CA+BAzJ,IAAI8F,CAAJ,CACD,CA3FD,CA6FIoE,YAAc,QAAdA,YAAc,CAASJ,CAAT,CACS1H,CADT,CAESuG,CAFT,CAIlB,CACE3I,IAAI,cAAJ,CADF,CAKE,GAAI8F,GAAMnF,EAAEiI,IAAF,CAAO,CACfC,KAAM,MADS,CAEfC,IAAKb,QAFU,CAGfxG,KAAM,CACJ0I,EAAGL,CADC,CAEJM,EAAGhI,CAFC,CAHS,CAOf4G,QAAS,iBAASlD,CAAT,CAAc,CACrB6C,EAAGvG,CAAH,CAAS0D,CAAT,CACD,CATc,CAUfV,MAAO,eAAS+D,CAAT,CAAgBC,CAAhB,CAAuCW,CAAvC,CAA0D,CAE/D,GADA/J,IAAI,OAAJ,CACA,CAAkB,OAAf,MAA2C,CAAjB,KAAMqJ,MAAnC,CACE1I,EAAE,cAAF,EAAkB2I,IAAlB,CAAuB,qGAAvB,CADF,CAEE3I,EAAE,cAAF,EAAkBU,IAAlB,EAFF,KAIK,CACHlB,OAAOqI,YAAP,CAAoBgB,UAApB,CAA+B,WAA/B,CADG,CAEH,GAAIK,GAAWvB,KAAKC,KAAL,CAAWpI,OAAOqI,YAAP,CAAoBC,OAApB,CAA4B,UAA5B,CAAX,CAAf,CACgB,IAAb,IAHA,GAIDoB,EAAWQ,sBAJV,EAMa,IAAb,IANA,CAODd,WAPC,CAUDK,aAAaC,CAAb,CACa,SAASM,CAAT,CAAW,CACTD,YAAYC,CAAZ,CAAe/H,CAAf,CAAqBuG,CAArB,CACD,CAHd,CAKH,CACF,CAhCc,CAiCfc,SAAU,MAjCK,CAAP,CAAV,CAmCAzJ,IAAI8F,CAAJ,CACD,CA1ID,CA6IIa,OAAQ,QAARA,OAAQ,EAAW,CACrBjB,WADqB,CAErB,GAAItD,GAAOoD,UAAX,CACArF,OAAOqI,YAAP,MAA8BF,KAAKY,SAAL,CAAe5E,MAAMyC,WAAN,EAAf,CAHT,CAIrB,GAAI+C,GAAY3J,OAAOqI,YAAP,CAAoBC,OAApB,CAA4B,WAA5B,CAAhB,CACgB,IAAb,GALkB,CASnBc,WATmB,CAMnBW,YAAYJ,CAAZ,CAAuB1H,CAAvB,CAA6ByD,SAA7B,CAKH,CAxJD,CA0JIwE,qBAAuB,QAAvBA,qBAAuB,EAAW,CAEpC,GAAIR,GAAW,CAAEG,EAAGrJ,EAAE,OAAF,EAAWiH,GAAX,EAAL,CACEqC,EAAGtJ,EAAE,WAAF,EAAeiH,GAAf,EADL,CAAf,CAFoC,MAInB,EAAd,IAASoC,CAAT,EAAkC,EAAd,IAASC,CAJI,EAKlC9J,OAAOqI,YAAP,CAAoBS,OAApB,CAA4B,UAA5B,CAAwCX,KAAKY,SAAL,CAAeW,CAAf,CAAxC,CALkC,CAM3BA,CAN2B,EAS3B,IAEV,CArKD,CAuKIS,cAAgB,QAAhBA,cAAgB,EAAW,CAI7B,MAHAV,cAAaS,sBAAb,CACa,SAASE,CAAT,CAAoB,CAAE5D,QAAU,CAD7C,CAGA,GACD,CA5KD,CA8KI6D,aAAe,QAAfA,aAAe,CAAUxG,CAAV,CAAa,CAChB,EAAX,IAAEyG,KADyB,EAE5BH,eAEH,CAlLD,CAoLII,aAAe,QAAfA,aAAe,CAAU1G,CAAV,CAAa,CAE9B,MADAsG,gBACA,GACD,CAvLD,CAyLIK,UAAY,IAzLhB,CA0LIlG,YAAc,QAAdA,YAAc,EAAqB,IAAZmG,EAAY,4CAAN,IAAM,cACrCzK,OAAO0K,YAAP,CAAoBF,SAApB,CADqC,CAErCA,UAAYxK,OAAO2K,UAAP,CAAkBnE,MAAlB,CAAyBiE,CAAzB,CACb,CA7LD,CA+LIG,aAAe,QAAfA,aAAe,CAAS9G,CAAT,CAAgB+G,CAAhB,CAA0BjG,CAA1B,CAAkC,CACrC,KAAV,GAD+C,EAGhC,MAAV,GAH0C,GAKjD3D,SALiD,CAMjDqD,aANiD,CAQpD,CAvMD,CAyMIwG,OAAS,QAATA,OAAS,CAAUjH,CAAV,CAAa,CAGxB,MAFAuF,YAEA,CADApJ,OAAOqI,YAAP,CAAoBgB,UAApB,CAA+B,WAA/B,CACA,GACD,CA7MD,CAgNI0B,KAAO,QAAPA,KAAO,EAAW,CACW,OAA5B,SAAOpL,QAAP,CAAgBC,QADC,EAElBY,EAAE,WAAF,EAAemB,IAAf,CAAoB,MAApB,CAA4B,MAA5B,CAFkB,CAKpBnB,EAAE,UAAF,EAAc0C,KAAd,CAAoBqH,YAApB,CALoB,CAMpB/J,EAAE,WAAF,EAAewK,QAAf,CAAwBX,YAAxB,CANoB,CAOpB7J,EAAE,OAAF,EAAWwK,QAAX,CAAoBX,YAApB,CAPoB,CAQpB7J,EAAE,WAAF,EAAe0C,KAAf,CAAqB4H,MAArB,CARoB,CASpBtK,EAAE,SAAF,EAAa0C,KAAb,CAAmBjC,OAAnB,CAToB,CAUpBT,EAAE,MAAF,EAAU0C,KAAV,CAAgBjC,OAAhB,CAVoB,CAYpBT,EAAE,sBAAF,EAA0ByB,IAA1B,CAA+B,kBAA/B,CAZoB,CAapB8E,SAASrE,GAAT,CAAa,SAASuI,CAAT,CAAY,CACvB,GAAI1H,GAAO/C,EAAEiB,SAASC,aAAT,CAAuB,QAAvB,CAAF,CAAX,CACA6B,EAAKtB,IAAL,CAAUgJ,EAAGjE,KAAb,CAFuB,CAGvBzD,EAAK5B,IAAL,CAAU,MAAV,CAAkB,QAAlB,CAHuB,CAIvB4B,EAAKnB,QAAL,CAAc,KAAd,CAJuB,CAKvBmB,EAAKnB,QAAL,CAAc,aAAd,CALuB,CAMvB5B,EAAE+C,CAAF,EAAQL,KAAR,CAAc,UAAY,CACxBiB,MAAM+G,WAAN,CAAkBD,EAAGnH,KAArB,CADwB,CAExB0C,QACD,CAHD,CANuB,CAUvBhG,EAAE,WAAF,EAAe2B,MAAf,CAAsBoB,CAAtB,CAVuB,CAWvB/C,EAAE,WAAF,EAAe2B,MAAf,CAAsB,GAAtB,CACD,CAZD,CAboB,CA2BpB3B,EAAE2K,SAAF,CAAY,CACVC,WAAY,CACV,MAAO,YAAU,CACfhC,WACD,CAHS,CADF,CAAZ,CA3BoB,CAmCpBjF,MAAMkH,EAAN,CAAS,aAAT,CAAwBT,YAAxB,CAnCoB,CAoCpBzG,MAAMkH,EAAN,CAAS,kBAAT,CAA6B5G,iBAA7B,CApCoB,CAsCpB,GAAI0C,GAASF,gBAAb,CACIqE,EAAW,CAAEvH,MAAF,CADf,CAEGoD,EAAO8C,CAAP,QAxCiB,CA4CZjK,OAAOqI,YAAP,aA5CY,GA6ClBiD,EAAWnD,KAAKC,KAAL,CAAWpI,OAAOqI,YAAP,KAAX,CA7CO,GAyClBiD,EAAW,CAAEvH,IAAK,CAAC,CAAEG,OAAQiD,EAAO8C,CAAjB,CAAD,CAAP,CAzCO,CA0ClBjK,OAAOL,QAAP,CAAgBwH,MAAhB,CAAyB,EA1CP,EA+CpBhD,MAAM+G,WAAN,CAAkBI,CAAlB,CA/CoB,CAgDpB/F,WAhDoB,CAiDpBtE,SAjDoB,CAkDpBuF,QACD,CAnQD,CAqQAhG,EAAEiB,QAAF,EAAY8J,KAAZ,CAAkBR,IAAlB,C","file":"demo.js","sourcesContent":["// @flow -*- indent-tabs-mode: nil; tab-width: 2; js2-basic-offset: 2; coding: utf-8; -*-\n/* global $, Quill, history, console, repl, external */\n\n\"use strict\";\n\n// TODO: Clicking examples before reply comes will apply check twice;\n// need to cancel running requests when sending new ones, or at least\n// when switching examples.\n\n/* :: type reps = Array<string> */\n/* :: type errlist = Array<[string, number, number, string, string, Array<string>, string]> */\n/* :: type result = {text: string, tokErrs: errlist, docErrs: any, sentErrs: any} */\n/* :: type cb = (text: string, X:result) => void */\n/* :: type authcb = (text: string) => void */\n\nvar debug = window.location.protocol === \"file:\";\nvar log = debug ? console.log.bind(window.console) : function() {};\n\n// Define our error underlines as a kind of inline formatting in Quill:\nlet Inline = Quill.import('blots/inline');\nclass ErrorBlot extends Inline {\n  static create(err) {\n    let node = super.create();\n    if(typeof(err) != \"object\") {\n      console.log(\"Error creating ErrorBlot, expected object, not \"+typeof(err));\n      return super.create();\n    }\n    $(node).data(\"error\", err);\n    // TODO: Set css properties directly here instead of having one class per colour?\n    var colour = \"blue\";\n    if(errtypes() == undefined || errtypes().length < err.typ+1 || err.typ == undefined) {\n      console.log(\"Couldn't find err.typ \"+err.typ+\" in errtypes()!\");\n    }\n    else if(errtypes()[err.typ].length >= 3) {\n      colour = errtypes()[err.typ][2];\n    };\n    node.setAttribute(\"class\", \"error error-\"+colour);\n    return node;\n  }\n  static formats(node) {\n    return $(node).data(\"error\");\n  }\n\n  /**\n   * Changes DOM\n   */\n  showrep(beg/*:number*/,\n          len/*:number*/\n         )/*:void*/\n  {\n    var spanoff = $(this.domNode).offset(),\n        newoff = { top:  spanoff.top+20,\n                   left: spanoff.left },\n        repmenu = $('#repmenu'),\n        at_same_err = repmenu.offset().top == newoff.top && repmenu.offset().left == newoff.left;\n    if(repmenu.is(\":visible\") && at_same_err) {\n      hiderep();\n    }\n    else {\n      repmenu.show();\n      repmenu.offset(newoff);\n      if(!at_same_err) {\n        this.makerepmenu(beg, len);\n      }\n    }\n  };\n\n  /**\n   * Changes DOM\n   * Populates menu.\n   * TODO: ignore-button\n   */\n  makerepmenu(beg/*:number*/,\n              len/*:number*/\n             ) {\n    var span = this.domNode,\n        err = $(span).data(\"error\");\n    // We're looking at a new error, populate the table anew:\n    $(\"#repmenu_tbl\").empty();\n    var tbody = $(document.createElement('tbody'));\n    tbody.attr(\"role\", \"listbox\");\n\n    var tr_typ =  $(document.createElement('tr')),\n    td_typ =  $(document.createElement('td')),\n    a_typ =  $(document.createElement('span'));\n    if(errtypes()[err.typ].length < 2) {\n      a_typ.text(\"Ukjent feiltype\");\n    }\n    else {\n      a_typ.text(errtypes()[err.typ][1]);\n    }\n    a_typ.attr(\"aria-disabled\", \"true\");\n    td_typ.append(a_typ);\n    td_typ.addClass(\"repmenu_typ\");\n    tr_typ.append(td_typ);\n    tbody.append(tr_typ);\n\n    if(err.exp != \"\") {\n      var tr_exp =  $(document.createElement('tr')),\n      td_exp =  $(document.createElement('td')),\n      a_exp =  $(document.createElement('span'));\n      a_exp.text(err.exp);\n      a_exp.attr(\"aria-disabled\", \"true\");\n      td_exp.append(a_exp);\n      td_exp.addClass(\"repmenu_exp\");\n      tr_exp.append(td_exp);\n      tbody.append(tr_exp);\n    }\n\n    err.rep.map(function(r){\n      var tr_rep =  $(document.createElement('tr')),\n          td_rep =  $(document.createElement('td')),\n          a_rep =  $(document.createElement('a'));\n      if(r == \"\") {\n        a_rep.text(\"(fjern)\");\n      }\n      else {\n        a_rep.text(r.replace(/ /g, \" \")); // ensure they're not trimmed away, e.g. at ends\n      }\n      if(r.lastIndexOf(\" \", 0)==0 || r.indexOf(\" \",r.length-1)==r.length-1) {\n        // start/end is a space, ensure it's visible:\n        a_rep.addClass(\"hl-space\");\n      }\n      a_rep.attr(\"role\", \"option\");\n      td_rep.append(a_rep);\n      td_rep.addClass(\"repmenu_rep\");\n      td_rep.addClass(\"repmenu_nonfirst\");\n      // has to be on td since <a> doesn't fill the whole td\n      td_rep.click({ beg: beg,\n                     len: len,\n                     r: r\n                   },\n                   replaceErr);\n      tr_rep.append(td_rep);\n      tbody.append(tr_rep);\n    });\n\n    var tr_ign =  $(document.createElement('tr')),\n    td_ign =  $(document.createElement('td')),\n    a_ign =  $(document.createElement('a'));\n    a_ign.text(\"Ignorer feiltypen\");\n    a_ign.attr(\"role\", \"option\");\n    td_ign.append(a_ign);\n    td_ign.addClass(\"repmenu_ign\");\n    td_ign.addClass(\"repmenu_nonfirst\");\n    tr_ign.append(td_ign);\n    tbody.append(tr_ign);\n\n    $(\"#repmenu_tbl\").append(tbody);\n  };\n\n}\nErrorBlot.blotName = 'error';\nErrorBlot.tagName = 'span';\nQuill.register(ErrorBlot);\n\nvar replaceErr = function(e) {\n  hiderep();\n  var delta = { ops:[\n    { retain: e.data.beg },\n    { delete: e.data.len },\n    { insert: e.data.r }\n  ]};\n  // source=user since user clicked \"replace\":\n  quill.updateContents(delta, \"user\");\n  atMostOneSpace(e.data.beg);\n  checkOnIdle(2000);\n  quill.focus();\n};\n\n/**\n * Changes DOM\n */\nvar hiderep = function()/*:void*/\n{\n  //log(\"hiderep\");\n  var repmenu = $('#repmenu');\n  repmenu.offset({top:0, left:0}); // avoid some potential bugs with misplacement\n  repmenu.hide();\n};\n\n\nvar onSelectionChange = function(range, _oldRange, source) {\n  if(range != null && range.length === 0 && source == 'user') {\n    var erroroffset = quill.scroll.descendant(ErrorBlot, range.index),\n        error = erroroffset[0],\n        offset = erroroffset[1];\n    if(error != null) {\n      var beg = range.index - offset,\n          len = error.length();\n      error.showrep(beg, len);\n    }\n  }\n};\n\nvar atMostOneSpace = function(i) {\n  var t = getFText();\n  while(t[i-1] == \" \") {\n    i--;\n  }\n  var len = 0;\n  while(t[i+len] == \" \") {\n    len++;\n  }\n  // If there were more than two spaces, leave just one:\n  if(len > 1) {\n    quill.deleteText(i, len-1, \"user\");\n  }\n};\n\n\nvar clearErrs = function () {\n  quill.formatText(0, quill.getLength(), \"error\", false);\n};\n\nvar applyErrs = function(text, res) {\n  res.tokErrs.forEach(function(x) {\n    var length = x[2] - x[1];\n    log(x);\n    quill.formatText(x[1], length,\n                     \"error\",{\n                       str: x[0], // TODO: should we assert that the form is the same?\n                       beg: x[1],\n                       end: x[2],\n                       len: length,\n                       typ: x[3],\n                       rep: x[4],\n                       exp: x[5]\n                     });\n  });\n  log(res);\n};\n\n\nvar toolbarOptions = [\n  [{ header: [1, 2, 3, false] }],\n  ['bold', 'italic', 'underline'],\n  ['link'],\n  [{ list: 'ordered' }, { list: 'bullet' }],\n  ['clean'],                    // ie. remove formatting\n  ['check'],\n];\n\nvar quill = new Quill('#editor', {\n  modules: {\n    toolbar: {\n      container: toolbarOptions,\n      handlers: {\n        check: function(_val) { check(); }\n      }\n    }\n  },\n  theme: 'snow',\n  placeholder: 'Skriv noe her, eller prøv eksemplene nedenfor'\n});\n\n// quill.formatText treats videos/images as having a length of one,\n// while quill.getText treats them as having a length of zero – the\n// following allows round-tripping without mixing up indices:\nvar getFText = function() {\n  return quill\n    .getContents()\n    .ops\n    .map(function(op) {\n      return typeof op.insert === 'string' ? op.insert : ' ';\n    })\n    .join('');\n};\n\nvar examples = [\n  { title: \"Tung tekst\",\n    delta: { ops: [{ insert:\"I etterkant av vurderingen anbefales det at organisasjonen har sterkt fokus på forbedring. Vi vil gjerne foreholde dere risikoen ved anvendelse av metoder som kan medføre spørsmål i forhold til resultatet. \"}]}},\n  { title: \"Uformelt brev\",\n    delta: { ops: [{ insert: \"Hei!! \\n Jeg viser til tidligere telefonsamtale med Pål-Fredik om Hausmannsgate. Det hadde vært kjempe fint om vi kunne fått til et møte ganske snart. Det haster ikke men det passer best for meg før iovermorgen. Rapporten er så og si ferdig og jeg vil veldig gjerne høre dine innspill hvis du har noen.\"}]}},\n  { title: \"Navnekonsekvens\",\n    delta: { ops: [{ insert: \"Vi vil motta varer fra Mexiko ukentlig; planen er å fortsette importen så lenge det er nødvendig, skriver markedsdirektør Arne Bjerkeli i et kundebrev. Arne Bjørkeli opplyser i tillegg at bedriften nå aksepterer mCash.\"}]}},\n  { title: \"Kontekstsensitive feil\", // som alle er til stedet i huset\n    delta: { ops: [{ insert: \"Jeg fikk et godt innrykk hvordan han tok imot han.\\nDet var minst en ting som burde vert sagt til en vert i stede for dette.\\n\\nHar du en vill hunn i flokken, så tror jeg hunn også vill prøve å rømme.\\n\\nDet ble stormene jubel da bilende til prinsen kjørte forbi.\"}]}},\n  { title: \"Tegnsetting\",\n    delta: { ops: [{ insert: \"Neste periode vil vi - etter planen - få implementert dette (nye)systemet, med A/ B-testing og hele pakka. Noe som bør gi bedre data .\"}] }},\n  { title: \"Forvekslinger\",\n    delta: { ops: [{ insert: \"Hun var faktisk talt en frontkjemper for forsiktighet og tok sine forhåndsregler i kjølevannet av erfaringene.\"}] }},\n  { title: \"Anglisismer\",\n    delta: { ops: [{ insert: \"Dette er for alle praktiske formål feil; det performes ikke bra i vinteren.\"}] }},\n];\n\nvar searchToObject = function ()\n{\n  // like http://stackoverflow.com/a/7090123/69663 but check for '='\n  var pairs = window.location.search.substring(1).split(\"&\"),\n      obj = {};\n  for (var i in pairs) {\n    if (pairs[i].indexOf('=') > -1) {\n      var pair = pairs[i].split(\"=\");\n      var key = pair[0],\n          val = pair[1].replace(/\\+/g, '%20');\n      obj[decodeURIComponent(key)] = decodeURIComponent(val);\n    }\n  }\n  return obj;\n};\n\nvar port/*:string*/ = window.location.protocol === \"file:\" ? \"8080\" : window.location.port;\nvar hostname/*:string*/ = window.location.hostname === \"\" ? \"localhost\" : window.location.hostname;\nvar protocol/*:string*/ = window.location.protocol === \"file:\" ? \"http:\" : window.location.protocol;\nvar apiversion/*:string*/=\"/v1\";\n\nvar checkUrl/*:string*/ = protocol+\"//\"+hostname+\":\"+(port.toString())+apiversion+\"/check\";\nvar authUrl/*:string*/ = protocol+\"//\"+hostname+\":\"+(port.toString())+apiversion+\"/getAuthToken\";\nvar errtypesUrl/*:string*/ = protocol+\"//\"+hostname+\":\"+(port.toString())+apiversion+\"/errtypesmsg\";\nlog(checkUrl);\nlog(authUrl);\nlog(errtypesUrl);\n\nvar userLang = function() {\n  // TODO: browser prefs\n  return \"nob\";\n};\n\nvar errtypes = function() {\n  return JSON.parse(window.localStorage.getItem(\"errtypes\"));\n};\n\nvar getErrtypes = function(cb) {\n  var res = $.ajax({\n    type: \"GET\",\n    url: errtypesUrl,\n    data: {\n      lang: userLang()\n    },\n    success: function(errtypes){\n      log(\"errtypes gotten\");\n      log(errtypes);\n      window.localStorage.setItem(\"errtypes\", JSON.stringify(errtypes));\n      cb();\n    },\n    error: function(jqXHR, textStatus/*:string*/, err/*:string*/) {\n      if(textStatus === \"error\" && jqXHR.status === 0) {\n        $(\"#serverfault\").html(\"Det kan se ut som om tjeneren er nede, eller du er frakoplet internett. Prøv å laste siden på nytt.\");\n      }\n      else if(textStatus === \"error\") {\n        $(\"#serverfault\").html(\"Ånei! Fikk<div>\"+textStatus+\": \"+err+\"(\"+jqXHR.status+\")\"+\"</div>fra tjeneren ved henting av feiltyper. Prøv å laste siden på nytt.\");\n      }\n      $(\"#serverfault\").show();\n      // TODO: Probably shouldn't hide editor completely in this case:\n      showLogin();\n      window.localStorage.removeItem(\"errtypes\");\n    },\n    dataType: \"json\"\n  });\n  log(res);\n};\n\nvar hideLogin = function () {\n  $(\"#serverfault\").hide();\n  $(\"#loginform\").hide();\n  $(\"#content\").removeClass(\"blur\");\n  $(\"#login-wrapper\").removeClass(\"block-view\");\n  $(\"#logout\").show();\n};\n\nvar showLogin = function () {\n  // caller decides whether to show #serverfault\n  $(\"#loginform\").show();\n  $(\"#content\").addClass(\"blur\");\n  $(\"#login-wrapper\").addClass(\"block-view\");\n  $(\"#logout\").hide();\n};\n\nvar getAuthToken = function(userpass,\n                            cb/*:authcb*/)\n{\n  log(\"getAuthToken\");\n  var res = $.ajax({\n    type: \"POST\",\n    url: authUrl,\n    data: userpass,\n    success: function(authToken){\n      log(\"set storage authToken\");\n      window.localStorage.setItem(\"authToken\", authToken);\n      hideLogin();\n      getErrtypes(function() {\n        cb(authToken);\n      });\n    },\n    error: function(jqXHR, textStatus/*:string*/, errXHR/*:string*/) {\n      if((userpass == null || userpass.u == \"\" || userpass.p == \"\")) {\n        $(\"#serverfault\").html(\"Skriv inn e-post og passord: \");\n      }\n      else if(textStatus === \"error\" && errXHR === \"Unauthorized\") {\n        $(\"#serverfault\").html(\"Feil e-post/passord; prøv å logge inn igjen: \");\n      }\n      else if(textStatus === \"error\" && jqXHR.status === 0) {\n        $(\"#serverfault\").html(\"Det kan se ut som om tjeneren er nede, eller du er frakoplet internett. Prøv å laste siden på nytt.\");\n      }\n      else{\n        $(\"#serverfault\").html(\"Ånei! Fikk<div>\"+textStatus+\": \"+errXHR+\"(\"+jqXHR.status+\")\"+\"</div>fra tjeneren. Prøv å laste siden på nytt.\");\n      }\n      $(\"#serverfault\").show();\n      showLogin();\n      window.localStorage.removeItem(\"authToken\");\n    },\n    dataType: \"text\"\n  });\n  log(res);\n};\n\nvar servercheck = function(authToken/*:string*/,\n                           text/*:string*/,\n                           cb/*:cb*/\n                          )/*:void*/\n{\n  log(\"servercheck:\");\n  // TODO: Should this be synchronous? We can't really change the text\n  // after the user has typed unless the text still matches what we\n  // sent.\n  var res = $.ajax({\n    type: \"POST\",\n    url: checkUrl,\n    data: {\n      a: authToken,\n      q: text\n    },\n    success: function(res) {\n      cb(text, res);\n    },\n    error: function(jqXHR, textStatus/*:string*/, errXHR/*:string*/) {\n      log(\"error\");\n      if(textStatus === \"error\" && jqXHR.status === 0) {\n        $(\"#serverfault\").html(\"Det kan se ut som om tjeneren er nede, eller du er frakoplet internett. Prøv å laste siden på nytt.\");\n        $(\"#serverfault\").show();\n      }\n      else {\n        window.localStorage.removeItem(\"authToken\");\n        var userpass = JSON.parse(window.localStorage.getItem(\"userpass\"));\n        if(userpass === null) {\n          userpass = readLoginFormStoring();\n        }\n        if(userpass === null) {\n          showLogin();\n        }\n        else {\n          getAuthToken(userpass,\n                       function(a){\n                         servercheck(a, text, cb);\n                       });\n        }\n      }\n    },\n    dataType: \"json\"\n  });\n  log(res);\n};\n\n\nvar check = function() {\n  clearErrs();\n  var text = getFText();\n  window.localStorage[\"text\"] = JSON.stringify(quill.getContents());\n  var authToken = window.localStorage.getItem(\"authToken\");\n  if(authToken != null) {\n    servercheck(authToken, text, applyErrs);\n  }\n  else {\n    showLogin();\n  }\n};\n\nvar readLoginFormStoring = function() {\n  // What kind of failures can $('#id').val() give?\n  var userpass = { u: $('#user').val(),\n                   p: $('#password').val() };\n  if(userpass.u != \"\" && userpass.p != \"\") {\n    window.localStorage.setItem(\"userpass\", JSON.stringify(userpass));\n    return userpass;\n  }\n  else {\n    return null;                // like JSON.parse(localStorage) gives\n  }\n};\n\nvar loginFromForm = function() {\n  getAuthToken(readLoginFormStoring(),\n               function(_authToken){ check(); });\n  // Ensure we don't reload the page (due to input type submit):\n  return false;\n};\n\nvar loginOnEnter = function (e) {\n  if(e.which == 13) {\n    loginFromForm();\n  }\n};\n\nvar loginOnClick = function (e) {\n  loginFromForm();\n  return false;\n};\n\nvar idleTimer = null;\nvar checkOnIdle = function(delay=3000) {\n  window.clearTimeout(idleTimer);\n  idleTimer = window.setTimeout(check, delay);\n};\n\nvar onTextChange = function(delta, oldDelta, source) {\n  if (source == 'api') {\n  }\n  else if (source == 'user') {\n    // Note that our own replaceErr events are also source==user\n    hiderep();\n    checkOnIdle();\n  }\n};\n\nvar logout = function (e) {\n  showLogin();\n  window.localStorage.removeItem(\"authToken\");\n  return false;\n};\n\n\nvar init = function() {\n  if(window.location.protocol == \"http:\") {\n    $('#password').attr(\"type\", \"text\");\n  }\n\n  $('#login_b').click(loginOnClick);\n  $('#password').keypress(loginOnEnter);\n  $('#user').keypress(loginOnEnter);\n  $('#logout_b').click(logout);\n  $(\"#editor\").click(hiderep);\n  $(\"body\").click(hiderep);\n\n  $('#examples-wrapper h4').text(\"Eksempeltekster:\");\n  examples.map(function(ex){\n    var node = $(document.createElement('button'));\n    node.text(ex.title);\n    node.attr(\"type\", \"button\");\n    node.addClass(\"btn\");\n    node.addClass(\"btn-default\");\n    $(node).click(function () {\n      quill.setContents(ex.delta);\n      check();\n    });\n    $('#examples').append(node);\n    $('#examples').append(\" \");\n  });\n\n  $.ajaxSetup({\n    statusCode: {\n      \"401\": function(){\n        showLogin();\n      }\n    }\n  });\n\n  quill.on('text-change', onTextChange);\n  quill.on('selection-change', onSelectionChange);\n\n  var search = searchToObject();\n  var initText = { ops: [] };\n  if(search.q != undefined) {\n    initText = { ops: [{ insert: search.q }]};\n    window.location.search = \"\"; // so a reload doesn't undo the localStorage\n  }\n  else if(window.localStorage[\"text\"] != undefined) {\n    initText = JSON.parse(window.localStorage[\"text\"]);\n  }\n  quill.setContents(initText);\n  clearErrs();\n  hiderep();\n  check();\n};\n\n$(document).ready(init);\n"]}